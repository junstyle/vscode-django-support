var H=Object.create;var v=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty;var V=(t,n)=>{for(var e in n)v(t,e,{get:n[e],enumerable:!0})},E=(t,n,e,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of A(n))!M.call(t,r)&&r!==e&&v(t,r,{get:()=>n[r],enumerable:!(i=R(n,r))||i.enumerable});return t};var j=(t,n,e)=>(e=t!=null?H(F(t)):{},E(n||!t||!t.__esModule?v(e,"default",{value:t,enumerable:!0}):e,t)),L=t=>E(v({},"__esModule",{value:!0}),t);var z={};V(z,{activate:()=>B,deactivate:()=>q});module.exports=L(z);var s=require("vscode");var h=require("prettier"),D=require("vscode"),O=j(require("prettier/parser-html")),Q=j(require("prettier-plugin-django"));function U(t,n){let e={tabWidth:2,printWidth:5e3,semi:!1,singleQuote:!0,trailingComma:"none",twigPrintWidth:5e3,twigMultiTags:["with,endwith"],twigAlwaysBreakObjects:!1,twigSingleQuote:!0,parser:"melody",plugins:[],htmlWhitespaceSensitivity:"ignore",twigPrintEmbedElements:!1};Object.assign(e,h.resolveConfig.sync(t.uri.fsPath)??[]),e.twigSingleQuote=!0,e.plugins=[Q],e.parser="melody",e.htmlWhitespaceSensitivity="ignore";let i={text:t.getText()};try{if(i.text=(0,h.format)(i.text,e),!i.text)throw new Error("django-html: formatting failed");$(i,e),n?.clear()}catch(r){if(n&&r.loc){n.clear();let o=r.loc;o.end||(o.end={line:o.start.line,column:o.start.column+1});let a=o.start.line-1,m=o.start.column-1,g=o.end.line-1,p=o.end.column-1,l=new D.Range(a,m,g,p);setTimeout(()=>n.set(t.uri,[new D.Diagnostic(l,r.message.split(" 	 ")[0].split(`
`)[0],0)]),250)}}return i.text}function $(t,n){let e="  ";n.useTabs?e="	":n.tabWidth&&(e=" ".repeat(n.tabWidth));let i=t.text.includes(`\r
`)?`\r
`:`
`,r=O.parsers.html.parse(t.text,null,{}),o=0,a=0,m=g=>{if(!!g.children)for(let p=0;p<g.children.length;p++){let l=g.children[p];if(l.type=="element"&&(l.name=="script"||l.name=="style")){let P=l.sourceSpan.start.offset,x=P;for(;x>-1&&t.text[x]!=`
`;)x--;let y=t.text.slice(x+1,P);n.parser=l.name=="script"?"babel":"css";let c=l.children[0],d=`
`.repeat(c.sourceSpan.start.line+a)+" ".repeat(c.sourceSpan.start.col)+c.value;d=i+(0,h.format)(d,n).trim().split(i).map(k=>y+e+k).join(i)+i+y;let S=c.sourceSpan.start.offset;t.text=t.text.slice(0,S+o)+d+t.text.slice(S+c.value.length+o),o+=d.length-c.value.length,a+=d.split(`
`).length-c.value.split(`
`).length}else m(l)}};m(r)}var u=require("vscode"),f=new Map,C=new Map;u.workspace.registerTextDocumentContentProvider("dj-embedded-content",{provideTextDocumentContent:t=>{let n=t.path.lastIndexOf("/"),e=t.path.slice(1).slice(0,n-1),i=decodeURIComponent(e);return f.get(i)}});function I(t,n){t.subscriptions.push(u.workspace.onDidChangeTextDocument(e=>{n.includes(e.document.languageId)&&C.delete(e.document.uri.toString())})),t.subscriptions.push(u.workspace.onDidCloseTextDocument(e=>{e.languageId=="html"&&f.delete(e.uri.toString())})),t.subscriptions.push(u.workspace.onDidRenameFiles(e=>{e.files.forEach(i=>{f.delete(i.oldUri.toString())})}))}function w(t,n){n=n??"html";let e=t.uri.toString();n!="html"&&(e+="."+n),f.set(e,t.getText());let i;return C.has(e)?i=C.get(e):(i=`/${encodeURIComponent(e)}/${Math.random()}.${n}`,C.set(e,i)),u.Uri.from({scheme:"dj-embedded-content",authority:"django-html",path:i})}function W(){f.clear()}var b=["django-html"],T;function B(t){I(t,b),T=s.languages.createDiagnosticCollection("django"),t.subscriptions.push(T),t.subscriptions.push(s.languages.registerDocumentFormattingEditProvider("django-html",{provideDocumentFormattingEdits:async(n,e,i)=>{let r=n.getText();if(!r)return;let a=U(n,T);if(a&&a!=r){let m=new s.Range(n.positionAt(0),n.positionAt(r.length));return[new s.TextEdit(m,a)]}else return[]}})),t.subscriptions.push(s.languages.registerCompletionItemProvider(b,{provideCompletionItems:async(n,e,i,r)=>{let o=w(n);return await s.commands.executeCommand("vscode.executeCompletionItemProvider",o,e,r.triggerCharacter)}},".","(",":","<")),t.subscriptions.push(s.languages.registerHoverProvider(b,{provideHover:async(n,e,i)=>{let r=w(n);return(await s.commands.executeCommand("vscode.executeHoverProvider",r,e))?.[0]}}))}function q(){W()}0&&(module.exports={activate,deactivate});
